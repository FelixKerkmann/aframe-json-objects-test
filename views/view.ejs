<!DOCTYPE html>
<html>
<head>
    <script src="https://aframe.io/releases/1.3.0/aframe.min.js"></script>
    <script src="../public/js/backsideFixing.js"></script>
    <script src="../public/js/popup.js"></script>
    <script src="../public/components/input-listen.js"></script>
    <script src="../public/components/selectable.js"></script>
    <script type="importmap">
      {
      "imports": {
       "three": "https://cdn.skypack.dev/three@0.139.2/build/three.module",
          "three/": "https://cdn.skypack.dev/three@0.139.2/"
      }
     }
    </script>
    <script src="/public/components/objectSelectorComponent.js" type="module"></script>
    <script src="/socket.io/socket.io.js"></script>
    <script src="/public/js/showroom-client.js"></script>
    <script src="/public/js/objectSelectorController.js"></script>
    <link rel="stylesheet" type="text/css" href="../public/css/milligram.min.css">
    <link rel="stylesheet" type="text/css" href="../public/css/style.css">
    <link rel="icon" type="image/png" href="../public/resources/icons/favicon.png">
</head>
<body>

<!-- Scene view -->
<div id="sceneView" class="wide" >
    <a-scene shadow="type: pcfsoft" cursor="rayOrigin: mouse" vr-mode-ui="enterVRButton: #myEnterVRButton">
        <a-assets>
            <img id="citySkybox" src="../public/resources/skyboxes/citySkybox.jpg">
            <a-asset-item id="roomModel" src="../public/resources/uploads/rooms/DemoRaumDiffuseOnlyCompressed.glb"></a-asset-item>
            <%- assets %>
        </a-assets>

        <a-sky id="skybox" src="#citySkybox"></a-sky>

        <a-entity id="cameraRig" position="0 1.6 0">
            <a-entity id="player"
                  camera
                  wasd-controls
                  look-controls>
                </a-entity>
        </a-entity>

        <a-entity id="ObjectSelector"></a-entity>

        <a-entity id="ambientLight"
                  light="type: ambient; color: #FFFFFF; intensity: 0.6;">
        </a-entity>

        <a-entity id="pointLight"
                  light="type: point; color: #FFFFFF; intensity: 0.6; castShadow:true; shadowMapHeight: 1024; shadowMapWidth:1024;"
                  position="0 2.5 0"
        ></a-entity>

        <a-entity id="Room"
                  gltf-model=#roomModel
                  position="0 0 0"
                  rotation="0 0 0"
                  scale="1 1 1"
                  shadow="receive:true">
        </a-entity>

        <%- entities %>

        <a id="myEnterVRButton" href="#">
            <div class="a-enter-vr">
                <button class="enter-vr-button" title="Fullscreen">
                    Fullscreen
                </button>
            </div>
        </a>

    </a-scene>

    <div id="bottomMenu">
        <button id="addElementButton" onclick="togglePopUp('popup')">Insert new object</button>
        <div class="gizmo-mode">
            <a id="buttonGizmoViewTranslation"
               class="button enabled"
               onclick="changeTransformMode('translation')">
                <img src="../public/resources/icons/GizmoTranslate.png">
            </a>
        </div>
        <div class="gizmo-mode">
            <a id="buttonGizmoViewRotation"
               class="button"
               onclick="changeTransformMode('rotation')" >
                <img src="../public/resources/icons/GizmoRotation.png">
            </a>
        </div>
        <div class="gizmo-mode">
            <a id="buttonGizmoViewScale"
               class="button"
               onclick="changeTransformMode('scale')">
                <img src="../public/resources/icons/GizmoScale.png">
            </a>
        </div>
    </div>
</div>

<!-- Right panel -->
<div id="rightPanel" class="disabled">
    <div class="navbar">
        <a class="active" id="nav-modelView" onclick="toggleNavbar('nav-modelView')">Selected</a>
        <a class="" id="nav-models" onclick="toggleNavbar('nav-models')">Models</a>
        <a class="" id="nav-inventory" onclick="toggleNavbar('nav-inventory')">Inventory</a>
    </div>
    <div id="modelView">
        <p id="objectName" class="attributeTitle"><i>No object selected</i></p>
        <p class="attributeTitle">
            Position (T)
            <a id="buttonGizmoTitleTranslation" onclick="changeTransformMode('translation')" class="button button-clear enabled">
                <img src="../public/resources/icons/GizmoTranslate.png">
            </a>
        </p>
        <div class="objectAttributeContainer">
            <label for="positionX">X</label>
            <input type="number"
                   id="positionX"
                   name="positionX"
                   step="0.05"
                   onfocusin="storeOldValue(this.id)"
                   onchange="emitOnValuesChange(this.id)"
                   onfocusout="emitOnValueSubmit(this.id)">
        </div>

        <div class="objectAttributeContainer">
            <label for="positionY">Y</label>
            <input type="number"
                   id="positionY"
                   name="positionY"
                   step="0.05"
                   onfocusin="storeOldValue(this.id)"
                   onchange="emitOnValuesChange(this.id)"
                   onfocusout="emitOnValueSubmit(this.id)">
        </div>

        <div class="objectAttributeContainer">
            <label for="positionZ">Z</label>
            <input type="number"
                   id="positionZ"
                   name="positionZ"
                   step="0.05"
                   onfocusin="storeOldValue(this.id)"
                   onchange="emitOnValuesChange(this.id)"
                   onfocusout="emitOnValueSubmit(this.id)">
        </div>

        <p class="attributeTitle">
            Rotation (R)
            <a id="buttonGizmoTitleRotation" onclick="changeTransformMode('rotation')" class="button button-clear">
                <img src="../public/resources/icons/GizmoRotation.png">
            </a>
        </p>
        <div class="objectAttributeContainer">
            <label for="rotationX">X</label>
            <input type="number"
                   id="rotationX"
                   name="rotationX"
                   step="1"
                   onfocusin="storeOldValue(this.id)"
                   onchange="emitOnValuesChange(this.id)"
                   onfocusout="emitOnValueSubmit(this.id)">
        </div>

        <div class="objectAttributeContainer">
            <label for="rotationY">Y</label>
            <input ctype="number"
                   id="rotationY"
                   name="rotationY"
                   step="1"
                   onfocusin="storeOldValue(this.id)"
                   onchange="emitOnValuesChange(this.id)"
                   onfocusout="emitOnValueSubmit(this.id)">
        </div>

        <div class="objectAttributeContainer">
            <label for="rotationZ">Z</label>
            <input type="number"
                   id="rotationZ"
                   name="rotationZ"
                   step="1"
                   onfocusin="storeOldValue(this.id)"
                   onchange="emitOnValuesChange(this.id)"
                   onfocusout="emitOnValueSubmit(this.id)">
        </div>

        <p class="attributeTitle" >
            Scale (E)
            <a id="buttonGizmoTitleScale" onclick="changeTransformMode('scale')" class="button button-clear">
                <img src="../public/resources/icons/GizmoScale.png">
            </a>
        </p>

        <div class="objectAttributeContainer">
            <label for="scale">X, Y, Z</label>
            <input type="number"
                   id="scale"
                   name="scale"
                   step="0.25"
                   onfocusin="storeOldValue(this.id)"
                   onchange="emitOnValuesChange(this.id)"
                   onfocusout="emitOnValueSubmit(this.id)">
        </div>

        <input type="hidden" id="useremail" name="useremail" value="<%- useremail %>"/>
        <input type="hidden" id="showroomid" name="showroomid" value="<%- showroomid %>"/>
        </br>
        <div class="objectAttributeContainer">
            <button class="button-outline button-delete removeObjectFromScene" type="submit" onclick="togglePopUp('popup-delete')">Remove Object</button>
        </div>
    </div>
    <div id="models" style="visibility: hidden; height: 0px;">
        <h3>Models</h3>
        <%- models %>
    </div>
    <div id="inventory" style="visibility: hidden; height: 0px;">
            <h3>Inventory</h3>
        <div class="inventoryContainer">
            <%- inventory %>
        </div>
            <button class="" onclick="toggleForm('upload-model')">Upload 3D-Modell</button>
            <div id="upload-model">
                <form action="/upload" class="" method="post" enctype="multipart/form-data">
                    <label>.glb - file</label>
                    <input type="file" id="gltffile" name="gltffile" accept=".glb, model/gltf-binary" required>
                    <br>
                    <br>
                    <button type="submit" class="btn-accept">Upload</button>
                    <button type="button" class="btn-cancel" onclick="closeForm('upload-model')">Cancel</button>
                </form>
            </div>
    </div>
    <div class="bottom-menu">
        <hr>
        <a href="../public/resources/keyboard_illustration_lila.png" target="_blank">Keyboard Shortcuts</a>
        <hr>
        <a class="button button-clear" href="/showrooms"> Back to Showrooms</a><br>
        <a class="button button-clear" href="/logout"> Logout</a>
    </div>
</div>

<div id="popup">
    <div class="popup-content">
        <form action="/object/<%- showroomid %>" class="form-container" method="post" enctype="application/json">
            <h3>Add 3D Model</h3>
            <label>3D Model:</label>
            <select name="files" id="files">
                <%- selection %>
            </select>
            <br>
            <label>Name:</label>
            <br>
            <input type="text" id="name" name="name" required>
            <br>
            <button class="btn btn-cancel float-left" onclick="togglePopUp('popup')">Cancel</button>
            <button class="btn btn-accept float-right" type="submit">Add</button>
        </form>
    </div>
</div>
<div id="popup-delete">
    <div class="popup-content">
        <p> Are you sure you want to remove the selected object </p>
        <a class="button button-delete cancel-delete btn-cancel" onclick="togglePopUp('popup-delete')">cancel</a>
        <button class="btn-accept button-delete float-right" type="submit" onclick="emitRemoveObject()">Remove</button>
    </div>
</div>
<script>
    window.onload = () => {
        initialiseObjectSelection();
        setAllBackfaces();
        setEventListenerOnModelList();
        setDeleteListener()
        centeringDeletePopups()

        window.addEventListener("keyup", function (event) {
            if (event.key === DESELECT_KEY) {
                const addModelhtmlElement = document.getElementById("popup");
                addModelhtmlElement.style.visibility = 'hidden';
            }
        });
    }

</script>
</body>
</html>

